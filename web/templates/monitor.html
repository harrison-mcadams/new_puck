{% extends "base.html" %}

{% block title %}Job Monitor - New Puck Analysis{% endblock %}
{% block nav_monitor %}active{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>How to Monitor</h2>
    </div>
    <div class="card-body">
        <p>To monitor a script, run it with output redirection to the <code>logs/</code> directory:</p>
        <div class="code-snippet">python scripts/your_script.py > logs/job_name.log 2>&1 &</div>
        <p class="text-muted" style="margin-bottom:0;">The <code>2>&1</code> ensures errors are also captured.
            The <code>&</code> runs it in the background.</p>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>Active Logs</h2>
        <button onclick="window.location.reload()" class="btn btn-sm btn-secondary">Refresh List</button>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Filename</th>
                    <th>Last Modified</th>
                    <th>Size</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if logs %}
                {% for log in logs %}
                <tr>
                    <td class="{{ log.status_class }}">{{ log.status }}</td>
                    <td><strong>{{ log.name }}</strong></td>
                    <td>{{ log.mtime }}</td>
                    <td>{{ log.size }}</td>
                    <td>
                        <a href="{{ url_for('monitor_view', filename=log.name) }}"
                            class="btn btn-sm btn-secondary">View</a>
                        <a href="{{ url_for('monitor_download', filename=log.name) }}" class="btn btn-sm btn-secondary"
                            style="margin-left: 5px;">Download</a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" class="empty-state">No log files found in <code>logs/</code></td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}